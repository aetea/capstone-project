{% extends "base.html" %}

{% block title %} 

    Welcome! 
    {% if city %}
        Welcome to {{ city["tele_city_name"].title() }}!
    {% endif %}

{% endblock %}
    
    
{% block body %} 

{% if not city %}
    <!-- NO CITY: show if user navigated here directly -->

    <div> 
        <h2>Oops! Looks like we don't have any info. Please try another city name.</h2>
        <h2>Where in the world would you like to go? 
            Enter a city in the search box above</h2>
    </div> 
    
{% endif %}
    
{% if city %} 

    <!-- photo carousel -->
    <div id="cityCarousel" class="carousel slide" data-bs-ride="carousel">
        <!-- show carousel indicators -->
        <div class="carousel-indicators">
            <button type="button" data-bs-target="#cityCarousel" data-bs-slide-to="0" class="active" aria-current="true" aria-label="Slide 1"></button>
            <button type="button" data-bs-target="#cityCarousel" data-bs-slide-to="1" aria-label="Slide 2"></button>
            <button type="button" data-bs-target="#cityCarousel" data-bs-slide-to="2" aria-label="Slide 3"></button>
        </div>
        <!-- put 3 images in the carousel -->
        <div class="carousel-inner">
            <div class="carousel-item active">
                <img src="/static/city-images/bundo-kim-p_D5pbQG5TE-unsplash.jpg" class="d-block w-100" alt="...">
            </div>
            <div class="carousel-item">
                <img src="/static/city-images/yeo-khee--e6Xu27_T50-unsplash.jpg" class="d-block w-100" alt="...">
            </div>
            <div class="carousel-item">
                <img src="/static/city-images/zequn-gui-xVFS3meofYM-unsplash.jpg" class="d-block w-100" alt="...">
            </div>
        </div>
        <!-- add next/prev buttons to carousel -->
        <button class="carousel-control-prev" type="button" data-bs-target="#cityCarousel" data-bs-slide="prev">
            <span class="carousel-control-prev-icon" aria-hidden="true"></span>
            <span class="visually-hidden">Previous</span>
        </button>
        <button class="carousel-control-next" type="button" data-bs-target="#cityCarousel" data-bs-slide="next">
            <span class="carousel-control-next-icon" aria-hidden="true"></span>
            <span class="visually-hidden">Next</span>
        </button>
    </div>

    <!-- put the rest of the page in a container -->
    <div class="container">
        <div class="row sec-head"><h1>{{ city["tele_city_name"].title() }}</h1></div>
        <div class="row alert alert-warning justify-content-between">
            <div class="col-8">country alert</div> 
            <div class="col"><a href="#travel">jump to travel advisories</a></div>
        </div>
        <div class="row" id="city-info-save">
            <div class="col-8">
                {{ city["summary"]|safe }}
                <p id="country">Country: {{ city["tele_country_name"].title() }}</p>
            </div>
            <div class="col-4">
                <form action="/save-city" method="POST">

                    <div id="save-buttons">
                        <button id="save-btn" name="save-city" value="{{ city["city_id"] }}"
                                class="btn btn-light {{ "show" if saved[0]==False else "hide" }}">
                            Save {{ city["tele_city_name"] }}
                        </button>
            
                        <button id="unsave-btn" name="unsave-city" value="{{ city["city_id"] }}"
                                class="btn btn-sm btn-primary {{ "show" if saved[0]==True else "hide" }}">
                        Unsave {{ city["tele_city_name"] }}
                        </button> Saved!
                    </div>
            
                    {% if saved[0]==False %} {% set show_past="hide" %} {% endif %}
                    {% if saved[1]=="past_local" %} {% set check="checked" %} {% endif %}
                    <div id="pastlocal-div" class={{ show_past }}>
                        <input type="checkbox" name="past-local" id="past-local-box" {{check}}>
                        <label for="past-local">I've also lived here</label>
                    </div>
            
                    <input type="hidden" id="h-uid" name="user-id" value="1">
                </form>
            </div>
        </div>
        <div class="row">
            <div class="col-8 my-3">
                <div class="flex-fill" id="map"></div>
            </div>
            <div class="col" id="city-right">
                <div class="row row-cols-2">
                    <div class="col">
                        <div class="card text-center my-3" id="safety">
                            <h5 class="card-header">Safety</h4>
                            <div class="class-body">
                            <!-- <h5 class="card-title">Safety</h5> -->
                            <h3 class="card-text">{{ city["scores"]["Safety"] }}</h3>
                            </div>
                        </div>
                    </div>
                    <div class="col">
                        <div class="card text-center my-3" id="healthcare">
                            <h5 class="card-header">Healthcare</h5>
                            <div class="class-body">
                            <h3 class="card-text">{{ city["scores"]["Healthcare"] }}</h3>
                            </h3></div>
                        </div>
                    </div>
                    <div class="col">
                        <div class="card text-center my-3" id="tolerance">
                            <h5 class="card-header">Tolerance</h5>
                            <div class="class-body">
                            <h3 class="card-text">{{ city["scores"]["Tolerance"] }}</h3>
                            </div>
                        </div>
                    </div>
                    <div class="col">
                        <div class="card text-center my-3" id="cost">
                            <h5 class="card-header">Cost of Living</h5>
                            <div class="class-body">
                            <h3 class="card-text">{{ city["scores"]["Cost of Living"] }}</h3>
                            </div>
                        </div>
                    </div>
                    <div class="col">
                        <div class="card text-center my-3" id="internet">
                            <h5 class="card-header">Internet Access</h5>
                            <div class="class-body">
                            <h3 class="card-text">{{ city["scores"]["Internet Access"] }}</h3>
                            </div>
                        </div>
                    </div>
                    <div class="col">
                        <div class="card text-center my-3" id="leisure">
                            <h5 class="card-header">Leisure & Culture</h5>
                            <div class="class-body">
                            <h3 class="card-text">{{ city["scores"]["Leisure & Culture"] }}</h3>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!-- <div class="col-2"> -->

            <!-- </div> -->
        </div>
        <hr class="featurette-divider">
        <div class="row sec-head" id="travel"><h2>✈️ travel advisories</h2></div>
        <div class="row sec-head"><h3>restrictions</h3></div>
        <div class="accordion" id="accordionExample">
            {% for r in sherpar %}
                {% if "international" == r["attributes"]["tags"][0] %}
                <div class="accordion-item">
                    <h2 class="accordion-header" id="head{{loop.index}}">
                        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapse{{loop.index}}" aria-expanded="false" aria-controls="collapse{{loop.index}}">
                            {{ r["attributes"]["title"] }}
                        </button>
                    </h2>
                    <div id="collapse{{loop.index}}" class="accordion-collapse collapse" aria-labelledby="head{{loop.index}}" data-bs-parent="#accordionExample">
                        <div class="accordion-body">
                            {{ r["attributes"]["description"] }}
                        </div>
                    </div>
                </div>
                {% endif %}
            {% endfor %}
        </div>
        <div class="row sec-head"><h3>procedures</h3></div>
        <div class="accordion" id="paccordian">
            {% for p in sherpap %}
                <div class="accordion-item">
                    <h2 class="accordion-header" id="phead{{loop.index}}">
                        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#pcollapse{{loop.index}}" aria-expanded="false" aria-controls="pcollapse{{loop.index}}">
                            {{ p["attributes"]["title"] }}
                        </button>
                    </h2>
                    <div id="pcollapse{{loop.index}}" class="accordion-collapse collapse" aria-labelledby="phead{{loop.index}}" data-bs-parent="#paccordian">
                        <div class="accordion-body">
                            {{ p["attributes"]["description"] }} 
                            || severity: {{ p["attributes"]["severity"] }}
                            || cat: {{ p["attributes"]["category"] }}
                            || <a href="{{ p["attributes"]["source"]["url"] }}">source</a>
                            || tags: {{ p["attributes"]["tags"] }}
                        </div>
                    </div>
                </div>
            {% endfor %}
        </div>
    </div>

    <hr class="featurette-divider">

    <!-- section 1: country travel warnings -->

        <div id="sherpa-country"><em>display sherpa country info</em>
            <p>{{ sherpac["attributes"] }}</p> 
        </div>

        <div id="procedures"><em>display procedures</em>
            <ul>{% for p in sherpap %}
            {# if "international" == p["attributes"]["tags"][0] #}
                <li><strong>{{ p["attributes"]["title"] }}</strong>
                {{ p["attributes"]["description"] }}
                || cat: {{ p["attributes"]["category"] }}
                || subcat: {{ p["attributes"]["subcategory"] }}
                || severity: {{ p["attributes"]["severity"] }}
                || <a href="{{ p["attributes"]["source"]["url"] }}">source</a>
                || tags: {{ p["attributes"]["tags"] }}</li>
            {# {% endif %} #}
            {% endfor %}
            </ul>
        </div>
        
    </div>

    <div id="city-photo"><img src="{{ city["img_link"]}}" alt="city-image"></div>


    <!-- < city map here >
    <div id="map"></div> -->

    {% endif %}

{% endblock %}

{% block scripts %}

    <script>
    const userId = JSON.parse({{ user.user_id | tojson }});
    let cityLat = {{ city["latlon"][0] }};
    let cityLon = {{ city["latlon"][1] }};
    let cityObj = {{ city | tojson }};

    $(document).ready(function(){
        $("#liveToast").toast('show');
    });
    </script>

    <script src="/static/js/ajax.js"></script> 
    <script src="/static/js/cityMap.js"></script>
    <script async defer
    src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBVRRwEZBjAe9DnCGtwPZs-imnBPhpMuGo&libraries=places&callback=initMap">
    </script>
    
{% endblock %}